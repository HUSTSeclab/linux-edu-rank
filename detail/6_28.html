<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patches contributed by Zhejiang University</title>
    <style>
    .pagination {
        border-top: 1px solid #ddd;
        border-bottom: 1px solid #ddd;
        overflow-wrap: break-word;
    }
    .pagination a, .pagination span {
        margin: 0 4px;
    }

    </style>
</head>
<body>
    <h1>Patches contributed by Zhejiang University</h1>
    <div class="pagination">
        <a href='6_27.html'>&lt;&lt;Prev</a><a href='6.html'>1</a><a href='6_2.html'>2</a><a href='6_3.html'>3</a><a href='6_4.html'>4</a><a href='6_5.html'>5</a><a href='6_6.html'>6</a><a href='6_7.html'>7</a><a href='6_8.html'>8</a><a href='6_9.html'>9</a><a href='6_10.html'>10</a><a href='6_11.html'>11</a><a href='6_12.html'>12</a><a href='6_13.html'>13</a><a href='6_14.html'>14</a><a href='6_15.html'>15</a><a href='6_16.html'>16</a><a href='6_17.html'>17</a><a href='6_18.html'>18</a><a href='6_19.html'>19</a><a href='6_20.html'>20</a><a href='6_21.html'>21</a><a href='6_22.html'>22</a><a href='6_23.html'>23</a><a href='6_24.html'>24</a><a href='6_25.html'>25</a><a href='6_26.html'>26</a><a href='6_27.html'>27</a><span>[28]</span><a href='6_29.html'>29</a><a href='6_30.html'>30</a><a href='6_31.html'>31</a><a href='6_32.html'>32</a><a href='6_33.html'>33</a><a href='6_34.html'>34</a><a href='6_29.html'>Next&gt;&gt;</a>
    </div>
    <hr>
    <pre>commit 9a19a939abfa7d949f584a7ad872e683473fdc14
Author: Dinghao Liu &lt;dinghao.liu@zju.edu.cn&gt;
Date:   Thu Aug 20 13:52:56 2020 +0800

    wilc1000: Fix memleak in wilc_bus_probe
    
    When devm_clk_get() returns -EPROBE_DEFER, spi_priv
    should be freed just like when wilc_cfg80211_init()
    fails.
    
    Fixes: 854d66df74aed ("staging: wilc1000: look for rtc_clk clock in spi mode")
    Signed-off-by: Dinghao Liu &lt;dinghao.liu@zju.edu.cn&gt;
    Acked-by: Ajay Singh &lt;ajay.kathat@microchip.com&gt;
    Signed-off-by: Kalle Valo &lt;kvalo@codeaurora.org&gt;
    Link: https://lore.kernel.org/r/20200820055256.24333-1-dinghao.liu@zju.edu.cn

diff --git a/drivers/net/wireless/microchip/wilc1000/spi.c b/drivers/net/wireless/microchip/wilc1000/spi.c
index 3f19e3f38a39..a18dac0aa6b6 100644
--- a/drivers/net/wireless/microchip/wilc1000/spi.c
+++ b/drivers/net/wireless/microchip/wilc1000/spi.c
@@ -112,9 +112,10 @@ static int wilc_bus_probe(struct spi_device *spi)
 	wilc-&gt;dev_irq_num = spi-&gt;irq;
 
 	wilc-&gt;rtc_clk = devm_clk_get(&amp;spi-&gt;dev, "rtc_clk");
-	if (PTR_ERR_OR_ZERO(wilc-&gt;rtc_clk) == -EPROBE_DEFER)
+	if (PTR_ERR_OR_ZERO(wilc-&gt;rtc_clk) == -EPROBE_DEFER) {
+		kfree(spi_priv);
 		return -EPROBE_DEFER;
-	else if (!IS_ERR(wilc-&gt;rtc_clk))
+	} else if (!IS_ERR(wilc-&gt;rtc_clk))
 		clk_prepare_enable(wilc-&gt;rtc_clk);
 
 	return 0;</pre><hr><pre>commit 8d95ab34b21ee0f870a9185b6457e8f6eb54914c
Author: Dinghao Liu &lt;dinghao.liu@zju.edu.cn&gt;
Date:   Thu Aug 20 13:48:19 2020 +0800

    wilc1000: Fix memleak in wilc_sdio_probe
    
    When devm_clk_get() returns -EPROBE_DEFER, sdio_priv
    should be freed just like when wilc_cfg80211_init()
    fails.
    
    Fixes: 8692b047e86cf ("staging: wilc1000: look for rtc_clk clock")
    Signed-off-by: Dinghao Liu &lt;dinghao.liu@zju.edu.cn&gt;
    Acked-by: Ajay Singh &lt;ajay.kathat@microchip.com&gt;
    Signed-off-by: Kalle Valo &lt;kvalo@codeaurora.org&gt;
    Link: https://lore.kernel.org/r/20200820054819.23365-1-dinghao.liu@zju.edu.cn

diff --git a/drivers/net/wireless/microchip/wilc1000/sdio.c b/drivers/net/wireless/microchip/wilc1000/sdio.c
index 3ece7b0b0392..351ff909ab1c 100644
--- a/drivers/net/wireless/microchip/wilc1000/sdio.c
+++ b/drivers/net/wireless/microchip/wilc1000/sdio.c
@@ -149,9 +149,10 @@ static int wilc_sdio_probe(struct sdio_func *func,
 	wilc-&gt;dev = &amp;func-&gt;dev;
 
 	wilc-&gt;rtc_clk = devm_clk_get(&amp;func-&gt;card-&gt;dev, "rtc");
-	if (PTR_ERR_OR_ZERO(wilc-&gt;rtc_clk) == -EPROBE_DEFER)
+	if (PTR_ERR_OR_ZERO(wilc-&gt;rtc_clk) == -EPROBE_DEFER) {
+		kfree(sdio_priv);
 		return -EPROBE_DEFER;
-	else if (!IS_ERR(wilc-&gt;rtc_clk))
+	} else if (!IS_ERR(wilc-&gt;rtc_clk))
 		clk_prepare_enable(wilc-&gt;rtc_clk);
 
 	dev_info(&amp;func-&gt;dev, "Driver Initializing success\n");</pre><hr><pre>commit 08572451b4b1783fdff787b0188c4d50fdf96b81
Author: Dinghao Liu &lt;dinghao.liu@zju.edu.cn&gt;
Date:   Wed Aug 26 21:24:58 2020 +0800

    drm/amd/display: Fix memleak in amdgpu_dm_mode_config_init
    
    When amdgpu_display_modeset_create_props() fails, state and
    state-&gt;context should be freed to prevent memleak. It's the
    same when amdgpu_dm_audio_init() fails.
    
    Signed-off-by: Dinghao Liu &lt;dinghao.liu@zju.edu.cn&gt;
    Signed-off-by: Alex Deucher &lt;alexander.deucher@amd.com&gt;

diff --git a/drivers/gpu/drm/amd/display/amdgpu_dm/amdgpu_dm.c b/drivers/gpu/drm/amd/display/amdgpu_dm/amdgpu_dm.c
index 785f21ea35df..e2e7138c4e3f 100644
--- a/drivers/gpu/drm/amd/display/amdgpu_dm/amdgpu_dm.c
+++ b/drivers/gpu/drm/amd/display/amdgpu_dm/amdgpu_dm.c
@@ -2905,12 +2905,18 @@ static int amdgpu_dm_mode_config_init(struct amdgpu_device *adev)
 				    &amp;dm_atomic_state_funcs);
 
 	r = amdgpu_display_modeset_create_props(adev);
-	if (r)
+	if (r) {
+		dc_release_state(state-&gt;context);
+		kfree(state);
 		return r;
+	}
 
 	r = amdgpu_dm_audio_init(adev);
-	if (r)
+	if (r) {
+		dc_release_state(state-&gt;context);
+		kfree(state);
 		return r;
+	}
 
 	return 0;
 }</pre><hr><pre>commit b67a468a4ccef593cd8df6a02ba3d167b77f0c81
Author: Dinghao Liu &lt;dinghao.liu@zju.edu.cn&gt;
Date:   Wed Aug 26 21:24:58 2020 +0800

    drm/amd/display: Fix memleak in amdgpu_dm_mode_config_init
    
    When amdgpu_display_modeset_create_props() fails, state and
    state-&gt;context should be freed to prevent memleak. It's the
    same when amdgpu_dm_audio_init() fails.
    
    Signed-off-by: Dinghao Liu &lt;dinghao.liu@zju.edu.cn&gt;
    Signed-off-by: Alex Deucher &lt;alexander.deucher@amd.com&gt;

diff --git a/drivers/gpu/drm/amd/display/amdgpu_dm/amdgpu_dm.c b/drivers/gpu/drm/amd/display/amdgpu_dm/amdgpu_dm.c
index 778edf427b94..b51c527a3f0d 100644
--- a/drivers/gpu/drm/amd/display/amdgpu_dm/amdgpu_dm.c
+++ b/drivers/gpu/drm/amd/display/amdgpu_dm/amdgpu_dm.c
@@ -2834,12 +2834,18 @@ static int amdgpu_dm_mode_config_init(struct amdgpu_device *adev)
 				    &amp;dm_atomic_state_funcs);
 
 	r = amdgpu_display_modeset_create_props(adev);
-	if (r)
+	if (r) {
+		dc_release_state(state-&gt;context);
+		kfree(state);
 		return r;
+	}
 
 	r = amdgpu_dm_audio_init(adev);
-	if (r)
+	if (r) {
+		dc_release_state(state-&gt;context);
+		kfree(state);
 		return r;
+	}
 
 	return 0;
 }</pre><hr><pre>commit c1e6414cdc371f9ed82cefebba7538499a3059f9
Author: Dinghao Liu &lt;dinghao.liu@zju.edu.cn&gt;
Date:   Thu Aug 20 12:28:27 2020 +0800

    ASoC: qcom: common: Fix refcount imbalance on error
    
    for_each_child_of_node returns a node pointer np with
    refcount incremented. So when devm_kzalloc fails, a
    pairing refcount decrement is needed to keep np's
    refcount balanced.
    
    Fixes: 16395ceee11f8 ("ASoC: qcom: common: Fix NULL pointer in of parser")
    Signed-off-by: Dinghao Liu &lt;dinghao.liu@zju.edu.cn&gt;
    Link: https://lore.kernel.org/r/20200820042828.10308-1-dinghao.liu@zju.edu.cn
    Signed-off-by: Mark Brown &lt;broonie@kernel.org&gt;

diff --git a/sound/soc/qcom/common.c b/sound/soc/qcom/common.c
index 5194d90ddb96..fd69cf8b1f23 100644
--- a/sound/soc/qcom/common.c
+++ b/sound/soc/qcom/common.c
@@ -52,8 +52,10 @@ int qcom_snd_parse_of(struct snd_soc_card *card)
 
 	for_each_child_of_node(dev-&gt;of_node, np) {
 		dlc = devm_kzalloc(dev, 2 * sizeof(*dlc), GFP_KERNEL);
-		if (!dlc)
-			return -ENOMEM;
+		if (!dlc) {
+			ret = -ENOMEM;
+			goto err;
+		}
 
 		link-&gt;cpus	= &amp;dlc[0];
 		link-&gt;platforms	= &amp;dlc[1];</pre><hr><pre>commit 15ac5cdafb9202424206dc5bd376437a358963f9
Author: Dinghao Liu &lt;dinghao.liu@zju.edu.cn&gt;
Date:   Sun Aug 23 19:29:35 2020 +0800

    firestream: Fix memleak in fs_open
    
    When make_rate() fails, vcc should be freed just
    like other error paths in fs_open().
    
    Signed-off-by: Dinghao Liu &lt;dinghao.liu@zju.edu.cn&gt;
    Signed-off-by: David S. Miller &lt;davem@davemloft.net&gt;

diff --git a/drivers/atm/firestream.c b/drivers/atm/firestream.c
index 2ca9ec802734..510250cf5c87 100644
--- a/drivers/atm/firestream.c
+++ b/drivers/atm/firestream.c
@@ -998,6 +998,7 @@ static int fs_open(struct atm_vcc *atm_vcc)
 				error = make_rate (pcr, r, &amp;tmc0, NULL);
 				if (error) {
 					kfree(tc);
+					kfree(vcc);
 					return error;
 				}
 			}</pre><hr><pre>commit e2d79cd8875fa8c3cc7defa98a8cc99a1ed0c62f
Author: Dinghao Liu &lt;dinghao.liu@zju.edu.cn&gt;
Date:   Sun Aug 23 16:56:47 2020 +0800

    net: arc_emac: Fix memleak in arc_mdio_probe
    
    When devm_gpiod_get_optional() fails, bus should be
    freed just like when of_mdiobus_register() fails.
    
    Fixes: 1bddd96cba03d ("net: arc_emac: support the phy reset for emac driver")
    Signed-off-by: Dinghao Liu &lt;dinghao.liu@zju.edu.cn&gt;
    Reviewed-by: Andrew Lunn &lt;andrew@lunn.ch&gt;
    Signed-off-by: David S. Miller &lt;davem@davemloft.net&gt;

diff --git a/drivers/net/ethernet/arc/emac_mdio.c b/drivers/net/ethernet/arc/emac_mdio.c
index 0187dbf3b87d..54cdafdd067d 100644
--- a/drivers/net/ethernet/arc/emac_mdio.c
+++ b/drivers/net/ethernet/arc/emac_mdio.c
@@ -153,6 +153,7 @@ int arc_mdio_probe(struct arc_emac_priv *priv)
 	if (IS_ERR(data-&gt;reset_gpio)) {
 		error = PTR_ERR(data-&gt;reset_gpio);
 		dev_err(priv-&gt;dev, "Failed to request gpio: %d\n", error);
+		mdiobus_free(bus);
 		return error;
 	}
 </pre><hr><pre>commit f97c04c316d8fea16dca449fdfbe101fbdfee6a2
Author: Dinghao Liu &lt;dinghao.liu@zju.edu.cn&gt;
Date:   Sun Aug 23 15:23:43 2020 +0800

    NFC: st95hf: Fix memleak in st95hf_in_send_cmd
    
    When down_killable() fails, skb_resp should be freed
    just like when st95hf_spi_send() fails.
    
    Signed-off-by: Dinghao Liu &lt;dinghao.liu@zju.edu.cn&gt;
    Signed-off-by: David S. Miller &lt;davem@davemloft.net&gt;

diff --git a/drivers/nfc/st95hf/core.c b/drivers/nfc/st95hf/core.c
index 9642971e89ce..457854765983 100644
--- a/drivers/nfc/st95hf/core.c
+++ b/drivers/nfc/st95hf/core.c
@@ -966,7 +966,7 @@ static int st95hf_in_send_cmd(struct nfc_digital_dev *ddev,
 	rc = down_killable(&amp;stcontext-&gt;exchange_lock);
 	if (rc) {
 		WARN(1, "Semaphore is not found up in st95hf_in_send_cmd\n");
-		return rc;
+		goto free_skb_resp;
 	}
 
 	rc = st95hf_spi_send(&amp;stcontext-&gt;spicontext, skb-&gt;data,</pre><hr><pre>commit dbb8df5c2d27610a87b0168a8acc89d73fbfde94
Author: Dinghao Liu &lt;dinghao.liu@zju.edu.cn&gt;
Date:   Sun Aug 23 14:55:12 2020 +0800

    ntb: intel: Fix memleak in intel_ntb_pci_probe
    
    The default error branch of a series of pdev_is_gen calls
    should free ndev just like what we've done in these calls.
    
    Fixes: 26bfe3d0b227 ("ntb: intel: Add Icelake (gen4) support for Intel NTB")
    Signed-off-by: Dinghao Liu &lt;dinghao.liu@zju.edu.cn&gt;
    Acked-by: Dave Jiang &lt;dave.jiang@intel.com&gt;
    Signed-off-by: Jon Mason &lt;jdmason@kudzu.us&gt;

diff --git a/drivers/ntb/hw/intel/ntb_hw_gen1.c b/drivers/ntb/hw/intel/ntb_hw_gen1.c
index 3185efeab487..093dd20057b9 100644
--- a/drivers/ntb/hw/intel/ntb_hw_gen1.c
+++ b/drivers/ntb/hw/intel/ntb_hw_gen1.c
@@ -1893,7 +1893,7 @@ static int intel_ntb_pci_probe(struct pci_dev *pdev,
 			goto err_init_dev;
 	} else {
 		rc = -EINVAL;
-		goto err_ndev;
+		goto err_init_pci;
 	}
 
 	ndev_reset_unsafe_flags(ndev);</pre><hr><pre>commit 7ef1fc57301f3cef7201497aa27e89ccb91737fe
Author: Dinghao Liu &lt;dinghao.liu@zju.edu.cn&gt;
Date:   Mon Aug 24 13:58:31 2020 +0800

    net: systemport: Fix memleak in bcm_sysport_probe
    
    When devm_kcalloc() fails, dev should be freed just
    like what we've done in the subsequent error paths.
    
    Fixes: 7b78be48a8eb6 ("net: systemport: Dynamically allocate number of TX rings")
    Signed-off-by: Dinghao Liu &lt;dinghao.liu@zju.edu.cn&gt;
    Signed-off-by: David S. Miller &lt;davem@davemloft.net&gt;

diff --git a/drivers/net/ethernet/broadcom/bcmsysport.c b/drivers/net/ethernet/broadcom/bcmsysport.c
index dfed9ade6950..0762d5d1a810 100644
--- a/drivers/net/ethernet/broadcom/bcmsysport.c
+++ b/drivers/net/ethernet/broadcom/bcmsysport.c
@@ -2491,8 +2491,10 @@ static int bcm_sysport_probe(struct platform_device *pdev)
 	priv-&gt;tx_rings = devm_kcalloc(&amp;pdev-&gt;dev, txq,
 				      sizeof(struct bcm_sysport_tx_ring),
 				      GFP_KERNEL);
-	if (!priv-&gt;tx_rings)
-		return -ENOMEM;
+	if (!priv-&gt;tx_rings) {
+		ret = -ENOMEM;
+		goto err_free_netdev;
+	}
 
 	priv-&gt;is_lite = params-&gt;is_lite;
 	priv-&gt;num_rx_desc_words = params-&gt;num_rx_desc_words;</pre>
    <div class="pagination">
        <a href='6_27.html'>&lt;&lt;Prev</a><a href='6.html'>1</a><a href='6_2.html'>2</a><a href='6_3.html'>3</a><a href='6_4.html'>4</a><a href='6_5.html'>5</a><a href='6_6.html'>6</a><a href='6_7.html'>7</a><a href='6_8.html'>8</a><a href='6_9.html'>9</a><a href='6_10.html'>10</a><a href='6_11.html'>11</a><a href='6_12.html'>12</a><a href='6_13.html'>13</a><a href='6_14.html'>14</a><a href='6_15.html'>15</a><a href='6_16.html'>16</a><a href='6_17.html'>17</a><a href='6_18.html'>18</a><a href='6_19.html'>19</a><a href='6_20.html'>20</a><a href='6_21.html'>21</a><a href='6_22.html'>22</a><a href='6_23.html'>23</a><a href='6_24.html'>24</a><a href='6_25.html'>25</a><a href='6_26.html'>26</a><a href='6_27.html'>27</a><span>[28]</span><a href='6_29.html'>29</a><a href='6_30.html'>30</a><a href='6_31.html'>31</a><a href='6_32.html'>32</a><a href='6_33.html'>33</a><a href='6_34.html'>34</a><a href='6_29.html'>Next&gt;&gt;</a>
    <div>
</body>
