<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patches contributed by Huazhong University of Science and Technology</title>
    <style>
    .pagination {
        border-top: 1px solid #ddd;
        border-bottom: 1px solid #ddd;
        overflow-wrap: break-word;
    }
    .pagination a, .pagination span {
        margin: 0 4px;
    }

    </style>
</head>
<body>
    <h1>Patches contributed by Huazhong University of Science and Technology</h1>
    <div class="pagination">
        <a href='17_3.html'>&lt;&lt;Prev</a><a href='17.html'>1</a><a href='17_2.html'>2</a><a href='17_3.html'>3</a><span>[4]</span><a href='17_5.html'>5</a><a href='17_6.html'>6</a><a href='17_7.html'>7</a><a href='17_5.html'>Next&gt;&gt;</a>
    </div>
    <hr>
    <pre>commit f05c7b7d9ea9477fcc388476c6f4ade8c66d2d26
Author: Kang Chen &lt;void0red@hust.edu.cn&gt;
Date:   Wed Apr 19 10:07:48 2023 +0800

    thermal/drivers/mediatek: Use devm_of_iomap to avoid resource leak in mtk_thermal_probe
    
    Smatch reports:
    1. mtk_thermal_probe() warn: 'apmixed_base' from of_iomap() not released.
    2. mtk_thermal_probe() warn: 'auxadc_base' from of_iomap() not released.
    
    The original code forgets to release iomap resource when handling errors,
    fix it by switch to devm_of_iomap.
    
    Fixes: 89945047b166 ("thermal: mediatek: Add tsensor support for V2 thermal system")
    Signed-off-by: Kang Chen &lt;void0red@hust.edu.cn&gt;
    Reviewed-by: Dongliang Mu &lt;dzm91@hust.edu.cn&gt;
    Reviewed-by: AngeloGioacchino Del Regno &lt;angelogioacchino.delregno@collabora.com&gt;
    Signed-off-by: Daniel Lezcano &lt;daniel.lezcano@linaro.org&gt;
    Link: https://lore.kernel.org/r/20230419020749.621257-1-void0red@hust.edu.cn

diff --git a/drivers/thermal/mediatek/auxadc_thermal.c b/drivers/thermal/mediatek/auxadc_thermal.c
index e908c8e9d558..49bcd5304802 100644
--- a/drivers/thermal/mediatek/auxadc_thermal.c
+++ b/drivers/thermal/mediatek/auxadc_thermal.c
@@ -1232,7 +1232,12 @@ static int mtk_thermal_probe(struct platform_device *pdev)
 		return -ENODEV;
 	}
 
-	auxadc_base = of_iomap(auxadc, 0);
+	auxadc_base = devm_of_iomap(&amp;pdev-&gt;dev, auxadc, 0, NULL);
+	if (IS_ERR(auxadc_base)) {
+		of_node_put(auxadc);
+		return PTR_ERR(auxadc_base);
+	}
+
 	auxadc_phys_base = of_get_phys_base(auxadc);
 
 	of_node_put(auxadc);
@@ -1248,7 +1253,12 @@ static int mtk_thermal_probe(struct platform_device *pdev)
 		return -ENODEV;
 	}
 
-	apmixed_base = of_iomap(apmixedsys, 0);
+	apmixed_base = devm_of_iomap(&amp;pdev-&gt;dev, apmixedsys, 0, NULL);
+	if (IS_ERR(apmixed_base)) {
+		of_node_put(apmixedsys);
+		return PTR_ERR(apmixed_base);
+	}
+
 	apmixed_phys_base = of_get_phys_base(apmixedsys);
 
 	of_node_put(apmixedsys);</pre><hr><pre>commit d325c34d9e7e38d371c0a299d415e9b07f66a1fb
Author: Gencen Gan &lt;gangecen@hust.edu.cn&gt;
Date:   Mon Apr 24 23:28:01 2023 +0800

    net: amd: Fix link leak when verifying config failed
    
    After failing to verify configuration, it returns directly without
    releasing link, which may cause memory leak.
    
    Paolo Abeni thinks that the whole code of this driver is quite
    "suboptimal" and looks unmainatained since at least ~15y, so he
    suggests that we could simply remove the whole driver, please
    take it into consideration.
    
    Simon Horman suggests that the fix label should be set to
    "Linux-2.6.12-rc2" considering that the problem has existed
    since the driver was introduced and the commit above doesn't
    seem to exist in net/net-next.
    
    Fixes: 1da177e4c3f4 ("Linux-2.6.12-rc2")
    Signed-off-by: Gan Gecen &lt;gangecen@hust.edu.cn&gt;
    Reviewed-by: Dongliang Mu &lt;dzm91@hust.edu.cn&gt;
    Signed-off-by: David S. Miller &lt;davem@davemloft.net&gt;

diff --git a/drivers/net/ethernet/amd/nmclan_cs.c b/drivers/net/ethernet/amd/nmclan_cs.c
index 823a329a921f..0dd391c84c13 100644
--- a/drivers/net/ethernet/amd/nmclan_cs.c
+++ b/drivers/net/ethernet/amd/nmclan_cs.c
@@ -651,7 +651,7 @@ static int nmclan_config(struct pcmcia_device *link)
     } else {
       pr_notice("mace id not found: %x %x should be 0x40 0x?9\n",
 		sig[0], sig[1]);
-      return -ENODEV;
+      goto failed;
     }
   }
 </pre><hr><pre>commit e515c330d7e22692d03475740fa45d179281cdf7
Author: Jianuo Kuang &lt;u202110722@hust.edu.cn&gt;
Date:   Mon Apr 24 10:41:40 2023 +0800

    drivers: nfc: nfcsim: remove return value check of `dev_dir`
    
    Smatch complains that:
    nfcsim_debugfs_init_dev() warn: 'dev_dir' is an error pointer or valid
    
    According to the documentation of the debugfs_create_dir() function,
    there is no need to check the return value of this function.
    Just delete the dead code.
    
    Signed-off-by: Jianuo Kuang &lt;u202110722@hust.edu.cn&gt;
    Reviewed-by: Dongliang Mu &lt;dzm91@hust.edu.cn&gt;
    Reviewed-by: Krzysztof Kozlowski &lt;krzysztof.kozlowski@linaro.org&gt;
    Link: https://lore.kernel.org/r/20230424024140.34607-1-u202110722@hust.edu.cn
    Signed-off-by: Jakub Kicinski &lt;kuba@kernel.org&gt;

diff --git a/drivers/nfc/nfcsim.c b/drivers/nfc/nfcsim.c
index 85bf8d586c70..44eeb17ae48d 100644
--- a/drivers/nfc/nfcsim.c
+++ b/drivers/nfc/nfcsim.c
@@ -367,11 +367,6 @@ static void nfcsim_debugfs_init_dev(struct nfcsim *dev)
 	}
 
 	dev_dir = debugfs_create_dir(devname, nfcsim_debugfs_root);
-	if (!dev_dir) {
-		NFCSIM_ERR(dev, "Could not create debugfs entries for nfc%d\n",
-			   idx);
-		return;
-	}
 
 	debugfs_create_u8("dropframe", 0664, dev_dir, &amp;dev-&gt;dropframe);
 }</pre><hr><pre>commit fb73556386e074e9bee9fa2d253aeaefe4e063e0
Author: Qinrun Dai &lt;flno@hust.edu.cn&gt;
Date:   Thu Apr 13 13:50:37 2023 +0000

    clocksource/drivers/davinci: Fix memory leak in davinci_timer_register when init fails
    
    Smatch reports:
    drivers/clocksource/timer-davinci.c:332 davinci_timer_register()
    warn: 'base' from ioremap() not released on lines: 274.
    
    Fix this and other potential memory leak problems
    by adding a set of corresponding exit lables.
    
    Fixes: 721154f972aa ("clocksource/drivers/davinci: Add support for clockevents")
    Signed-off-by: Qinrun Dai &lt;flno@hust.edu.cn&gt;
    Link: https://lore.kernel.org/r/20230413135037.1505799-1-flno@hust.edu.cn
    Signed-off-by: Daniel Lezcano &lt;daniel.lezcano@linaro.org&gt;

diff --git a/drivers/clocksource/timer-davinci.c b/drivers/clocksource/timer-davinci.c
index 9996c0542520..b1c248498be4 100644
--- a/drivers/clocksource/timer-davinci.c
+++ b/drivers/clocksource/timer-davinci.c
@@ -257,21 +257,25 @@ int __init davinci_timer_register(struct clk *clk,
 				resource_size(&amp;timer_cfg-&gt;reg),
 				"davinci-timer")) {
 		pr_err("Unable to request memory region\n");
-		return -EBUSY;
+		rv = -EBUSY;
+		goto exit_clk_disable;
 	}
 
 	base = ioremap(timer_cfg-&gt;reg.start, resource_size(&amp;timer_cfg-&gt;reg));
 	if (!base) {
 		pr_err("Unable to map the register range\n");
-		return -ENOMEM;
+		rv = -ENOMEM;
+		goto exit_mem_region;
 	}
 
 	davinci_timer_init(base);
 	tick_rate = clk_get_rate(clk);
 
 	clockevent = kzalloc(sizeof(*clockevent), GFP_KERNEL);
-	if (!clockevent)
-		return -ENOMEM;
+	if (!clockevent) {
+		rv = -ENOMEM;
+		goto exit_iounmap_base;
+	}
 
 	clockevent-&gt;dev.name = "tim12";
 	clockevent-&gt;dev.features = CLOCK_EVT_FEAT_ONESHOT;
@@ -296,7 +300,7 @@ int __init davinci_timer_register(struct clk *clk,
 			 "clockevent/tim12", clockevent);
 	if (rv) {
 		pr_err("Unable to request the clockevent interrupt\n");
-		return rv;
+		goto exit_free_clockevent;
 	}
 
 	davinci_clocksource.dev.rating = 300;
@@ -323,13 +327,27 @@ int __init davinci_timer_register(struct clk *clk,
 	rv = clocksource_register_hz(&amp;davinci_clocksource.dev, tick_rate);
 	if (rv) {
 		pr_err("Unable to register clocksource\n");
-		return rv;
+		goto exit_free_irq;
 	}
 
 	sched_clock_register(davinci_timer_read_sched_clock,
 			     DAVINCI_TIMER_CLKSRC_BITS, tick_rate);
 
 	return 0;
+
+exit_free_irq:
+	free_irq(timer_cfg-&gt;irq[DAVINCI_TIMER_CLOCKEVENT_IRQ].start,
+			clockevent);
+exit_free_clockevent:
+	kfree(clockevent);
+exit_iounmap_base:
+	iounmap(base);
+exit_mem_region:
+	release_mem_region(timer_cfg-&gt;reg.start,
+			   resource_size(&amp;timer_cfg-&gt;reg));
+exit_clk_disable:
+	clk_disable_unprepare(clk);
+	return rv;
 }
 
 static int __init of_davinci_timer_register(struct device_node *np)</pre><hr><pre>commit d184d60aa301e424cd0cf7de90b40744710a2417
Author: Zhengkang Huang &lt;zkhuang@hust.edu.cn&gt;
Date:   Wed Apr 19 18:03:03 2023 +0800

    platform/chrome: wilco_ec: remove return value check of debugfs_create_dir()
    
    Smatch complains that:
    wilco_ec_debugfs_probe() warn: 'debug_info-&gt;dir' is an error
    pointer or valid
    
    Debugfs checks are generally not supposed to be checked
    for errors and it is not necessary here.
    
    Just delete the dead code.
    
    Signed-off-by: Zhengkang Huang &lt;zkhuang@hust.edu.cn&gt;
    Reviewed-by: Dongliang Mu &lt;dzm91@hust.edu.cn&gt;
    Signed-off-by: Tzung-Bi Shih &lt;tzungbi@kernel.org&gt;
    Link: https://lore.kernel.org/r/20230419100303.343379-1-zkhuang@hust.edu.cn

diff --git a/drivers/platform/chrome/wilco_ec/debugfs.c b/drivers/platform/chrome/wilco_ec/debugfs.c
index a812788a0bdc..7a13f13b16cd 100644
--- a/drivers/platform/chrome/wilco_ec/debugfs.c
+++ b/drivers/platform/chrome/wilco_ec/debugfs.c
@@ -251,8 +251,6 @@ static int wilco_ec_debugfs_probe(struct platform_device *pdev)
 		return 0;
 	debug_info-&gt;ec = ec;
 	debug_info-&gt;dir = debugfs_create_dir("wilco_ec", NULL);
-	if (!debug_info-&gt;dir)
-		return 0;
 	debugfs_create_file("raw", 0644, debug_info-&gt;dir, NULL, &amp;fops_raw);
 	debugfs_create_file("h1_gpio", 0444, debug_info-&gt;dir, ec,
 			    &amp;fops_h1_gpio);</pre><hr><pre>commit 3c690a0d64f5964977050a91b6bba8de09c13d94
Author: Lanzhe Li &lt;u202212060@hust.edu.cn&gt;
Date:   Sun Apr 9 21:02:29 2023 +0800

    Bluetooth: fix inconsistent indenting
    
    Fixed a wrong indentation before "return".This line uses a 7 space
    indent instead of a tab.
    
    Signed-off-by: Lanzhe Li &lt;u202212060@hust.edu.cn&gt;
    Signed-off-by: Luiz Augusto von Dentz &lt;luiz.von.dentz@intel.com&gt;

diff --git a/net/bluetooth/hci_debugfs.c b/net/bluetooth/hci_debugfs.c
index b7f682922a16..ec0df2f9188e 100644
--- a/net/bluetooth/hci_debugfs.c
+++ b/net/bluetooth/hci_debugfs.c
@@ -189,7 +189,7 @@ static int uuids_show(struct seq_file *f, void *p)
 	}
 	hci_dev_unlock(hdev);
 
-       return 0;
+	return 0;
 }
 
 DEFINE_SHOW_ATTRIBUTE(uuids);</pre><hr><pre>commit b148b9abc8444c9e0579a6bbe47b2da6adf5a150
Author: Wang Zhang &lt;silver_code@hust.edu.cn&gt;
Date:   Fri Apr 21 23:10:09 2023 +0800

    net: ethernet: mediatek: remove return value check of `mtk_wed_hw_add_debugfs`
    
    Smatch complains that:
    mtk_wed_hw_add_debugfs() warn: 'dir' is an error pointer or valid
    
    Debugfs checks are generally not supposed to be checked
    for errors and it is not necessary here.
    
    fix it by just deleting the dead code.
    
    Signed-off-by: Wang Zhang &lt;silver_code@hust.edu.cn&gt;
    Reviewed-by: Dongliang Mu &lt;dzm91@hust.edu.cn&gt;
    Signed-off-by: David S. Miller &lt;davem@davemloft.net&gt;

diff --git a/drivers/net/ethernet/mediatek/mtk_wed_debugfs.c b/drivers/net/ethernet/mediatek/mtk_wed_debugfs.c
index 56f663439721..b244c02c5b51 100644
--- a/drivers/net/ethernet/mediatek/mtk_wed_debugfs.c
+++ b/drivers/net/ethernet/mediatek/mtk_wed_debugfs.c
@@ -252,8 +252,6 @@ void mtk_wed_hw_add_debugfs(struct mtk_wed_hw *hw)
 
 	snprintf(hw-&gt;dirname, sizeof(hw-&gt;dirname), "wed%d", hw-&gt;index);
 	dir = debugfs_create_dir(hw-&gt;dirname, NULL);
-	if (!dir)
-		return;
 
 	hw-&gt;debugfs_dir = dir;
 	debugfs_create_u32("regidx", 0600, dir, &amp;hw-&gt;debugfs_reg);</pre><hr><pre>commit eb74bfcfa99415f1a65ce021b8ac2256b7ed50bc
Author: Yingsha Xu &lt;ysxu@hust.edu.cn&gt;
Date:   Wed Apr 19 18:45:47 2023 +0800

    wifi: mac80211: remove return value check of debugfs_create_dir()
    
    Smatch complains that:
    debugfs_hw_add() warn: 'statsd' is an error pointer or valid
    
    Debugfs checks are generally not supposed to be checked for errors
    and it is not necessary here.
    
    Just delete the dead code.
    
    Signed-off-by: Yingsha Xu &lt;ysxu@hust.edu.cn&gt;
    Reviewed-by: Dongliang Mu &lt;dzm91@hust.edu.cn&gt;
    Link: https://lore.kernel.org/r/20230419104548.30124-1-ysxu@hust.edu.cn
    Signed-off-by: Johannes Berg &lt;johannes.berg@intel.com&gt;

diff --git a/net/mac80211/debugfs.c b/net/mac80211/debugfs.c
index dfb9f55e2685..207f772bd8ce 100644
--- a/net/mac80211/debugfs.c
+++ b/net/mac80211/debugfs.c
@@ -673,10 +673,6 @@ void debugfs_hw_add(struct ieee80211_local *local)
 
 	statsd = debugfs_create_dir("statistics", phyd);
 
-	/* if the dir failed, don't put all the other things into the root! */
-	if (!statsd)
-		return;
-
 #ifdef CONFIG_MAC80211_DEBUG_COUNTERS
 	DEBUGFS_STATS_ADD(dot11TransmittedFragmentCount);
 	DEBUGFS_STATS_ADD(dot11MulticastTransmittedFrameCount);</pre><hr><pre>commit d6f712f53b79f5017cdcefafb7a5aea9ec52da5d
Author: Yinhao Hu &lt;dddddd@hust.edu.cn&gt;
Date:   Wed Apr 12 13:58:52 2023 +0800

    usb: chipidea: fix missing goto in `ci_hdrc_probe`
    
    From the comment of ci_usb_phy_init, it returns an error code if
    usb_phy_init has failed, and it should do some clean up, not just
    return directly.
    
    Fix this by goto the error handling.
    
    Fixes: 74475ede784d ("usb: chipidea: move PHY operation to core")
    Reviewed-by: Dongliang Mu &lt;dzm91@hust.edu.cn&gt;
    Acked-by: Peter Chen &lt;peter.chen@kernel.org&gt;
    Signed-off-by: Yinhao Hu &lt;dddddd@hust.edu.cn&gt;
    Link: https://lore.kernel.org/r/20230412055852.971991-1-dddddd@hust.edu.cn
    Signed-off-by: Greg Kroah-Hartman &lt;gregkh@linuxfoundation.org&gt;

diff --git a/drivers/usb/chipidea/core.c b/drivers/usb/chipidea/core.c
index d1d252c87e4f..798cb077867a 100644
--- a/drivers/usb/chipidea/core.c
+++ b/drivers/usb/chipidea/core.c
@@ -1108,7 +1108,7 @@ static int ci_hdrc_probe(struct platform_device *pdev)
 	ret = ci_usb_phy_init(ci);
 	if (ret) {
 		dev_err(dev, "unable to init phy: %d\n", ret);
-		return ret;
+		goto ulpi_exit;
 	}
 
 	ci-&gt;hw_bank.phys = res-&gt;start;</pre><hr><pre>commit 359f5b0d4e26b7a7bcc574d6148b31a17cefe47d
Author: Li Lanzhe &lt;u202212060@hust.edu.cn&gt;
Date:   Wed Apr 19 07:50:29 2023 -0400

    spi: spi-rockchip: Fix missing unwind goto in rockchip_sfc_probe()
    
    If devm_request_irq() fails, then we are directly return 'ret' without
    clk_disable_unprepare(sfc-&gt;clk) and clk_disable_unprepare(sfc-&gt;hclk).
    
    Fix this by changing direct return to a goto 'err_irq'.
    
    Fixes: 0b89fc0a367e ("spi: rockchip-sfc: add rockchip serial flash controller")
    Signed-off-by: Li Lanzhe &lt;u202212060@hust.edu.cn&gt;
    Reviewed-by: Dongliang Mu &lt;dzm91@hust.edu.cn&gt;
    Link: https://lore.kernel.org/r/20230419115030.6029-1-u202212060@hust.edu.cn
    Signed-off-by: Mark Brown &lt;broonie@kernel.org&gt;

diff --git a/drivers/spi/spi-rockchip-sfc.c b/drivers/spi/spi-rockchip-sfc.c
index bd87d3c92dd3..69347b6bf60c 100644
--- a/drivers/spi/spi-rockchip-sfc.c
+++ b/drivers/spi/spi-rockchip-sfc.c
@@ -632,7 +632,7 @@ static int rockchip_sfc_probe(struct platform_device *pdev)
 	if (ret) {
 		dev_err(dev, "Failed to request irq\n");
 
-		return ret;
+		goto err_irq;
 	}
 
 	ret = rockchip_sfc_init(sfc);</pre>
    <div class="pagination">
        <a href='17_3.html'>&lt;&lt;Prev</a><a href='17.html'>1</a><a href='17_2.html'>2</a><a href='17_3.html'>3</a><span>[4]</span><a href='17_5.html'>5</a><a href='17_6.html'>6</a><a href='17_7.html'>7</a><a href='17_5.html'>Next&gt;&gt;</a>
    <div>
</body>
