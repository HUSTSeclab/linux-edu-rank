<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patches contributed by Zhejiang University</title>
    <style>
    .pagination {
        border-top: 1px solid #ddd;
        border-bottom: 1px solid #ddd;
        overflow-wrap: break-word;
    }
    .pagination a, .pagination span {
        margin: 0 4px;
    }

    </style>
</head>
<body>
    <h1>Patches contributed by Zhejiang University</h1>
    <div class="pagination">
        <a href='6_29.html'>&lt;&lt;Prev</a><a href='6.html'>1</a><a href='6_2.html'>2</a><a href='6_3.html'>3</a><a href='6_4.html'>4</a><a href='6_5.html'>5</a><a href='6_6.html'>6</a><a href='6_7.html'>7</a><a href='6_8.html'>8</a><a href='6_9.html'>9</a><a href='6_10.html'>10</a><a href='6_11.html'>11</a><a href='6_12.html'>12</a><a href='6_13.html'>13</a><a href='6_14.html'>14</a><a href='6_15.html'>15</a><a href='6_16.html'>16</a><a href='6_17.html'>17</a><a href='6_18.html'>18</a><a href='6_19.html'>19</a><a href='6_20.html'>20</a><a href='6_21.html'>21</a><a href='6_22.html'>22</a><a href='6_23.html'>23</a><a href='6_24.html'>24</a><a href='6_25.html'>25</a><a href='6_26.html'>26</a><a href='6_27.html'>27</a><a href='6_28.html'>28</a><a href='6_29.html'>29</a><span>[30]</span><a href='6_31.html'>31</a><a href='6_32.html'>32</a><a href='6_33.html'>33</a><a href='6_34.html'>34</a><a href='6_31.html'>Next&gt;&gt;</a>
    </div>
    <hr>
    <pre>commit 5c3a8a661e1bd9d7063485ac2d2ccb512c447129
Author: Dinghao Liu &lt;dinghao.liu@zju.edu.cn&gt;
Date:   Mon Jun 22 10:40:08 2020 +0800

    crypto: sun8i-ce - Fix runtime PM imbalance in sun8i_ce_cipher_init
    
    pm_runtime_get_sync() increments the runtime PM usage counter even
    the call returns an error code. Thus a corresponding decrement is
    needed on the error handling path to keep the counter balanced.
    
    Fix this by adding the missed function call.
    
    Signed-off-by: Dinghao Liu &lt;dinghao.liu@zju.edu.cn&gt;
    Signed-off-by: Herbert Xu &lt;herbert@gondor.apana.org.au&gt;

diff --git a/drivers/crypto/allwinner/sun8i-ce/sun8i-ce-cipher.c b/drivers/crypto/allwinner/sun8i-ce/sun8i-ce-cipher.c
index a6abb701bfc6..3665a0a2038f 100644
--- a/drivers/crypto/allwinner/sun8i-ce/sun8i-ce-cipher.c
+++ b/drivers/crypto/allwinner/sun8i-ce/sun8i-ce-cipher.c
@@ -358,6 +358,7 @@ int sun8i_ce_cipher_init(struct crypto_tfm *tfm)
 
 	return 0;
 error_pm:
+	pm_runtime_put_noidle(op-&gt;ce-&gt;dev);
 	crypto_free_sync_skcipher(op-&gt;fallback_tfm);
 	return err;
 }</pre><hr><pre>commit 5b78fac4b1ba731cf4177fdbc1e3a4661521bcd0
Author: Dinghao Liu &lt;dinghao.liu@zju.edu.cn&gt;
Date:   Wed Jun 24 14:46:26 2020 +0800

    dmaengine: tegra210-adma: Fix runtime PM imbalance on error
    
    pm_runtime_get_sync() increments the runtime PM usage counter even
    when it returns an error code. Thus a pairing decrement is needed on
    the error handling path to keep the counter balanced.
    
    Signed-off-by: Dinghao Liu &lt;dinghao.liu@zju.edu.cn&gt;
    Reviewed-by: Jon Hunter &lt;jonathanh@nvidia.com&gt;
    Link: https://lore.kernel.org/r/20200624064626.19855-1-dinghao.liu@zju.edu.cn
    Signed-off-by: Vinod Koul &lt;vkoul@kernel.org&gt;

diff --git a/drivers/dma/tegra210-adma.c b/drivers/dma/tegra210-adma.c
index db58d7e4f9fe..c5fa2ef74abc 100644
--- a/drivers/dma/tegra210-adma.c
+++ b/drivers/dma/tegra210-adma.c
@@ -658,6 +658,7 @@ static int tegra_adma_alloc_chan_resources(struct dma_chan *dc)
 
 	ret = pm_runtime_get_sync(tdc2dev(tdc));
 	if (ret &lt; 0) {
+		pm_runtime_put_noidle(tdc2dev(tdc));
 		free_irq(tdc-&gt;irq, tdc);
 		return ret;
 	}
@@ -869,8 +870,10 @@ static int tegra_adma_probe(struct platform_device *pdev)
 	pm_runtime_enable(&amp;pdev-&gt;dev);
 
 	ret = pm_runtime_get_sync(&amp;pdev-&gt;dev);
-	if (ret &lt; 0)
+	if (ret &lt; 0) {
+		pm_runtime_put_noidle(&amp;pdev-&gt;dev);
 		goto rpm_disable;
+	}
 
 	ret = tegra_adma_init(tdma);
 	if (ret)</pre><hr><pre>commit 52db11f38333f90dcdc9a12a09f9ec990516025d
Author: Dinghao Liu &lt;dinghao.liu@zju.edu.cn&gt;
Date:   Mon May 25 10:19:58 2020 +0200

    media: smiapp: Fix runtime PM imbalance on error
    
    When v4l2_async_register_subdev_sensor_common() returns
    an error code, a pairing runtime PM usage counter
    decrement is needed to keep the counter balanced.
    
    Signed-off-by: Dinghao Liu &lt;dinghao.liu@zju.edu.cn&gt;
    Signed-off-by: Sakari Ailus &lt;sakari.ailus@linux.intel.com&gt;
    Signed-off-by: Mauro Carvalho Chehab &lt;mchehab+huawei@kernel.org&gt;

diff --git a/drivers/media/i2c/smiapp/smiapp-core.c b/drivers/media/i2c/smiapp/smiapp-core.c
index 5e4f6a2ef78e..0a8d27481bd1 100644
--- a/drivers/media/i2c/smiapp/smiapp-core.c
+++ b/drivers/media/i2c/smiapp/smiapp-core.c
@@ -3103,6 +3103,7 @@ static int smiapp_probe(struct i2c_client *client)
 	return 0;
 
 out_disable_runtime_pm:
+	pm_runtime_put_noidle(&amp;client-&gt;dev);
 	pm_runtime_disable(&amp;client-&gt;dev);
 
 out_media_entity_cleanup:</pre><hr><pre>commit 4024d6f601e3c49bae9297930970f68d2621ea1d
Author: Dinghao Liu &lt;dinghao.liu@zju.edu.cn&gt;
Date:   Sat May 23 13:49:17 2020 +0200

    media: vpif: Fix runtime PM imbalance in vpif_probe
    
    When platform_get_resource() returns an error code, a
    pairing runtime PM usage counter decrement is needed
    to keep the counter balanced.
    
    Signed-off-by: Dinghao Liu &lt;dinghao.liu@zju.edu.cn&gt;
    Reviewed-by: Lad Prabhakar &lt;prabhakar.csengg@gmail.com&gt;
    Signed-off-by: Hans Verkuil &lt;hverkuil-cisco@xs4all.nl&gt;
    Signed-off-by: Mauro Carvalho Chehab &lt;mchehab+huawei@kernel.org&gt;

diff --git a/drivers/media/platform/davinci/vpif.c b/drivers/media/platform/davinci/vpif.c
index df66461f5d4f..f28c1b27eac6 100644
--- a/drivers/media/platform/davinci/vpif.c
+++ b/drivers/media/platform/davinci/vpif.c
@@ -458,6 +458,7 @@ static int vpif_probe(struct platform_device *pdev)
 	res_irq = platform_get_resource(pdev, IORESOURCE_IRQ, 0);
 	if (!res_irq) {
 		dev_warn(&amp;pdev-&gt;dev, "Missing IRQ resource.\n");
+		pm_runtime_put(&amp;pdev-&gt;dev);
 		return -EINVAL;
 	}
 </pre><hr><pre>commit 4f9b5709cc087337bf02f004f0a238ec7ebda25b
Author: Dinghao Liu &lt;dinghao.liu@zju.edu.cn&gt;
Date:   Sun May 24 04:59:02 2020 +0200

    media: exynos4-is: Fix runtime PM imbalance in fimc_is_probe
    
    pm_runtime_get_sync() increments the runtime PM usage counter even
    when it returns an error code. Thus a pairing decrement is needed on
    the error handling path to keep the counter balanced. For all error
    paths after pm_runtime_get_sync(), things are the same.
    
    Signed-off-by: Dinghao Liu &lt;dinghao.liu@zju.edu.cn&gt;
    Reviewed-by: Sylwester Nawrocki &lt;s.nawrocki@samsung.com&gt;
    Signed-off-by: Hans Verkuil &lt;hverkuil-cisco@xs4all.nl&gt;
    Signed-off-by: Mauro Carvalho Chehab &lt;mchehab+huawei@kernel.org&gt;

diff --git a/drivers/media/platform/exynos4-is/fimc-is.c b/drivers/media/platform/exynos4-is/fimc-is.c
index 64148b7e0d98..a474014f0a0f 100644
--- a/drivers/media/platform/exynos4-is/fimc-is.c
+++ b/drivers/media/platform/exynos4-is/fimc-is.c
@@ -871,6 +871,7 @@ static int fimc_is_probe(struct platform_device *pdev)
 err_sd:
 	fimc_is_unregister_subdevs(is);
 err_pm:
+	pm_runtime_put_noidle(dev);
 	if (!pm_runtime_enabled(dev))
 		fimc_is_runtime_suspend(dev);
 err_irq:</pre><hr><pre>commit 00b0228061fa2dc0536fbf3355fedf2d447df3bd
Author: Dinghao Liu &lt;dinghao.liu@zju.edu.cn&gt;
Date:   Sun May 24 05:34:04 2020 +0200

    media: exynos4-is: Fix runtime PM imbalance in isp_video_open
    
    pm_runtime_get_sync() increments the runtime PM usage counter even
    when it returns an error code. Thus a pairing decrement is needed on
    the error handling path to keep the counter balanced.
    
    Signed-off-by: Dinghao Liu &lt;dinghao.liu@zju.edu.cn&gt;
    Reviewed-by: Sylwester Nawrocki &lt;s.nawrocki@samsung.com&gt;
    Signed-off-by: Hans Verkuil &lt;hverkuil-cisco@xs4all.nl&gt;
    Signed-off-by: Mauro Carvalho Chehab &lt;mchehab+huawei@kernel.org&gt;

diff --git a/drivers/media/platform/exynos4-is/fimc-isp-video.c b/drivers/media/platform/exynos4-is/fimc-isp-video.c
index 15f443fa7208..612b9872afc8 100644
--- a/drivers/media/platform/exynos4-is/fimc-isp-video.c
+++ b/drivers/media/platform/exynos4-is/fimc-isp-video.c
@@ -293,6 +293,7 @@ static int isp_video_open(struct file *file)
 	if (!ret)
 		goto unlock;
 rel_fh:
+	pm_runtime_put_noidle(&amp;isp-&gt;pdev-&gt;dev);
 	v4l2_fh_release(file);
 unlock:
 	mutex_unlock(&amp;isp-&gt;video_lock);</pre><hr><pre>commit 779096916daede26699e75e51b0c3a000410d8ad
Author: Dinghao Liu &lt;dinghao.liu@zju.edu.cn&gt;
Date:   Thu May 21 13:56:07 2020 +0200

    media: camss: vfe: Fix runtime PM imbalance on error
    
    pm_runtime_get_sync() increments the runtime PM usage counter even
    when it returns an error code. Thus a pairing decrement is needed on
    the error handling path to keep the counter balanced.
    
    Signed-off-by: Dinghao Liu &lt;dinghao.liu@zju.edu.cn&gt;
    Signed-off-by: Hans Verkuil &lt;hverkuil-cisco@xs4all.nl&gt;
    Signed-off-by: Mauro Carvalho Chehab &lt;mchehab+huawei@kernel.org&gt;

diff --git a/drivers/media/platform/qcom/camss/camss-vfe.c b/drivers/media/platform/qcom/camss/camss-vfe.c
index a8c542fa647d..fc31c2c169cd 100644
--- a/drivers/media/platform/qcom/camss/camss-vfe.c
+++ b/drivers/media/platform/qcom/camss/camss-vfe.c
@@ -1265,12 +1265,12 @@ static int vfe_get(struct vfe_device *vfe)
 
 		ret = vfe_set_clock_rates(vfe);
 		if (ret &lt; 0)
-			goto error_clocks;
+			goto error_pm_runtime_get;
 
 		ret = camss_enable_clocks(vfe-&gt;nclocks, vfe-&gt;clock,
 					  vfe-&gt;camss-&gt;dev);
 		if (ret &lt; 0)
-			goto error_clocks;
+			goto error_pm_runtime_get;
 
 		ret = vfe_reset(vfe);
 		if (ret &lt; 0)
@@ -1282,7 +1282,7 @@ static int vfe_get(struct vfe_device *vfe)
 	} else {
 		ret = vfe_check_clock_rates(vfe);
 		if (ret &lt; 0)
-			goto error_clocks;
+			goto error_pm_runtime_get;
 	}
 	vfe-&gt;power_count++;
 
@@ -1293,10 +1293,8 @@ static int vfe_get(struct vfe_device *vfe)
 error_reset:
 	camss_disable_clocks(vfe-&gt;nclocks, vfe-&gt;clock);
 
-error_clocks:
-	pm_runtime_put_sync(vfe-&gt;camss-&gt;dev);
-
 error_pm_runtime_get:
+	pm_runtime_put_sync(vfe-&gt;camss-&gt;dev);
 	camss_pm_domain_off(vfe-&gt;camss, vfe-&gt;id);
 
 error_pm_domain:</pre><hr><pre>commit 606578801afe6ec8bb03f5d494a4bae49a684ef3
Author: Dinghao Liu &lt;dinghao.liu@zju.edu.cn&gt;
Date:   Thu May 21 14:06:21 2020 +0200

    media: camss: ispif: Fix runtime PM imbalance on error
    
    pm_runtime_get_sync() increments the runtime PM usage counter even
    when it returns an error code. Thus a pairing decrement is needed on
    the error handling path to keep the counter balanced.
    
    Signed-off-by: Dinghao Liu &lt;dinghao.liu@zju.edu.cn&gt;
    Signed-off-by: Hans Verkuil &lt;hverkuil-cisco@xs4all.nl&gt;
    Signed-off-by: Mauro Carvalho Chehab &lt;mchehab+huawei@kernel.org&gt;

diff --git a/drivers/media/platform/qcom/camss/camss-ispif.c b/drivers/media/platform/qcom/camss/camss-ispif.c
index 1f33b4eb198c..5722e971b184 100644
--- a/drivers/media/platform/qcom/camss/camss-ispif.c
+++ b/drivers/media/platform/qcom/camss/camss-ispif.c
@@ -344,8 +344,10 @@ static int ispif_set_power(struct v4l2_subdev *sd, int on)
 		}
 
 		ret = pm_runtime_get_sync(dev);
-		if (ret &lt; 0)
+		if (ret &lt; 0) {
+			pm_runtime_put_sync(dev);
 			goto exit;
+		}
 
 		ret = camss_enable_clocks(ispif-&gt;nclocks, ispif-&gt;clock, dev);
 		if (ret &lt; 0) {</pre><hr><pre>commit cf7b1c794d2f2362610143375b4156111e35aed5
Author: Dinghao Liu &lt;dinghao.liu@zju.edu.cn&gt;
Date:   Sat May 23 09:36:39 2020 +0200

    media: camss: csid: Fix runtime PM imbalance in csid_set_power
    
    pm_runtime_get_sync() increments the runtime PM usage counter even
    when it returns an error code. Thus a pairing decrement is needed on
    the error handling path to keep the counter balanced.
    
    Signed-off-by: Dinghao Liu &lt;dinghao.liu@zju.edu.cn&gt;
    Signed-off-by: Hans Verkuil &lt;hverkuil-cisco@xs4all.nl&gt;
    Signed-off-by: Mauro Carvalho Chehab &lt;mchehab+huawei@kernel.org&gt;

diff --git a/drivers/media/platform/qcom/camss/camss-csid.c b/drivers/media/platform/qcom/camss/camss-csid.c
index a5ae85674ffb..8a247b6f5550 100644
--- a/drivers/media/platform/qcom/camss/camss-csid.c
+++ b/drivers/media/platform/qcom/camss/camss-csid.c
@@ -562,8 +562,10 @@ static int csid_set_power(struct v4l2_subdev *sd, int on)
 		u32 hw_version;
 
 		ret = pm_runtime_get_sync(dev);
-		if (ret &lt; 0)
+		if (ret &lt; 0) {
+			pm_runtime_put_sync(dev);
 			return ret;
+		}
 
 		ret = regulator_enable(csid-&gt;vdda);
 		if (ret &lt; 0) {</pre><hr><pre>commit 90361693ad8d13a4311fc671903dcedd6ec06940
Author: Dinghao Liu &lt;dinghao.liu@zju.edu.cn&gt;
Date:   Thu May 21 12:17:35 2020 +0200

    media: coda: Fix runtime PM imbalance on error
    
    pm_runtime_get_sync() increments the runtime PM usage counter even
    when it returns an error code. Thus a pairing decrement is needed on
    the error handling path to keep the counter balanced.
    
    Signed-off-by: Dinghao Liu &lt;dinghao.liu@zju.edu.cn&gt;
    Signed-off-by: Hans Verkuil &lt;hverkuil-cisco@xs4all.nl&gt;
    Signed-off-by: Mauro Carvalho Chehab &lt;mchehab+huawei@kernel.org&gt;

diff --git a/drivers/media/platform/coda/coda-common.c b/drivers/media/platform/coda/coda-common.c
index 6f41f74d492c..3ab3d976d8ca 100644
--- a/drivers/media/platform/coda/coda-common.c
+++ b/drivers/media/platform/coda/coda-common.c
@@ -2653,7 +2653,7 @@ static int coda_open(struct file *file)
 
 	ret = clk_prepare_enable(dev-&gt;clk_per);
 	if (ret)
-		goto err_clk_per;
+		goto err_pm_get;
 
 	ret = clk_prepare_enable(dev-&gt;clk_ahb);
 	if (ret)
@@ -2692,9 +2692,8 @@ static int coda_open(struct file *file)
 	clk_disable_unprepare(dev-&gt;clk_ahb);
 err_clk_ahb:
 	clk_disable_unprepare(dev-&gt;clk_per);
-err_clk_per:
-	pm_runtime_put_sync(dev-&gt;dev);
 err_pm_get:
+	pm_runtime_put_sync(dev-&gt;dev);
 	v4l2_fh_del(&amp;ctx-&gt;fh);
 	v4l2_fh_exit(&amp;ctx-&gt;fh);
 err_coda_name_init:</pre>
    <div class="pagination">
        <a href='6_29.html'>&lt;&lt;Prev</a><a href='6.html'>1</a><a href='6_2.html'>2</a><a href='6_3.html'>3</a><a href='6_4.html'>4</a><a href='6_5.html'>5</a><a href='6_6.html'>6</a><a href='6_7.html'>7</a><a href='6_8.html'>8</a><a href='6_9.html'>9</a><a href='6_10.html'>10</a><a href='6_11.html'>11</a><a href='6_12.html'>12</a><a href='6_13.html'>13</a><a href='6_14.html'>14</a><a href='6_15.html'>15</a><a href='6_16.html'>16</a><a href='6_17.html'>17</a><a href='6_18.html'>18</a><a href='6_19.html'>19</a><a href='6_20.html'>20</a><a href='6_21.html'>21</a><a href='6_22.html'>22</a><a href='6_23.html'>23</a><a href='6_24.html'>24</a><a href='6_25.html'>25</a><a href='6_26.html'>26</a><a href='6_27.html'>27</a><a href='6_28.html'>28</a><a href='6_29.html'>29</a><span>[30]</span><a href='6_31.html'>31</a><a href='6_32.html'>32</a><a href='6_33.html'>33</a><a href='6_34.html'>34</a><a href='6_31.html'>Next&gt;&gt;</a>
    <div>
</body>
